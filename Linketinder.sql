CREATE TABLE "users" (
  "id_user" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "name" varchar(200) NOT NULL,
  "password" varchar(24) NOT NULL,
  "email" varchar(50) NOT NULL,
  "description" text NOT NULL
);

CREATE TABLE "countries" (
  "id_country" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "short" varchar(3) NOT NULL,
  "long" varchar(50) NOT NULL
);

CREATE TABLE "candidates" (
  "id_candidate" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "id_user" bigint NOT NULL,
  "cpf" varchar(20) NOT NULL UNIQUE,
  "birthdate" date NOT NULL
);

CREATE TABLE "companies" (
  "id_company" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "id_user" bigint NOT NULL,
  "cnpj" varchar(20) NOT NULL UNIQUE
);

CREATE TABLE "jobs" (
  "id_job" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "id_company" bigint NOT NULL,
  "description" text NOT NULL,
  "locale" varchar(150) NOT NULL
);

CREATE TABLE "competencies" (
  "id_competency" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "language" varchar(50) UNIQUE NOT NULL
);

CREATE TABLE "candidate_competency" (
  "id_candidate" bigint NOT NULL,
  "id_competency" bigint NOT NULL
);

CREATE TABLE "job_competency" (
  "id_job" bigint NOT NULL,
  "id_competency" bigint NOT NULL
);

CREATE TABLE "addresses" (
  "id_address" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "cep" varchar(15) NOT NULL,
  "country" bigint NOT NULL,
  "state" varchar(150) NOT NULL,
  "city" varchar(150) NOT NULL,
  "district" varchar(150) NOT NULL,
  "street" varchar(150) NOT NULL,
  "number" varchar(10) NOT NULL,
  "complement" varchar(10) NOT NULL
);

CREATE TABLE "user_address" (
  "id_user" bigint NOT NULL,
  "id_address" bigint NOT NULL
);

CREATE TABLE "likes" (
  "id_like" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "date_event" date NOT NULL
);

CREATE TABLE "like_candidate_job" (
  "id_like" bigint NOT NULL,
  "id_candidate" bigint NOT NULL,
  "id_job" bigint NOT NULL
);

CREATE TABLE "like_company_candidate" (
  "id_like" bigint NOT NULL,
  "id_company" bigint NOT NULL,
  "id_candidate" bigint NOT NULL
);

CREATE TABLE "matches" (
  "id_match" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "date_event" date NOT NULL,
  "id_candidate" bigint NOT NULL,
  "id_company" bigint NOT NULL
);

ALTER TABLE "candidates" ADD FOREIGN KEY ("id_user") REFERENCES "users" ("id_user");

ALTER TABLE "companies" ADD FOREIGN KEY ("id_user") REFERENCES "users" ("id_user");

ALTER TABLE "jobs" ADD FOREIGN KEY ("id_company") REFERENCES "companies" ("id_company");

ALTER TABLE "candidate_competency" ADD FOREIGN KEY ("id_candidate") REFERENCES "candidates" ("id_candidate");

ALTER TABLE "candidate_competency" ADD FOREIGN KEY ("id_competency") REFERENCES "competencies" ("id_competency");

ALTER TABLE "job_competency" ADD FOREIGN KEY ("id_job") REFERENCES "jobs" ("id_job");

ALTER TABLE "job_competency" ADD FOREIGN KEY ("id_competency") REFERENCES "competencies" ("id_competency");

ALTER TABLE "addresses" ADD FOREIGN KEY ("country") REFERENCES "countries" ("id_country");

ALTER TABLE "user_address" ADD FOREIGN KEY ("id_user") REFERENCES "users" ("id_user");

ALTER TABLE "user_address" ADD FOREIGN KEY ("id_address") REFERENCES "addresses" ("id_address");

ALTER TABLE "like_candidate_job" ADD FOREIGN KEY ("id_like") REFERENCES "likes" ("id_like");

ALTER TABLE "like_candidate_job" ADD FOREIGN KEY ("id_candidate") REFERENCES "candidates" ("id_candidate");

ALTER TABLE "like_candidate_job" ADD FOREIGN KEY ("id_job") REFERENCES "jobs" ("id_job");

ALTER TABLE "like_company_candidate" ADD FOREIGN KEY ("id_like") REFERENCES "likes" ("id_like");

ALTER TABLE "like_company_candidate" ADD FOREIGN KEY ("id_company") REFERENCES "companies" ("id_company");

ALTER TABLE "like_company_candidate" ADD FOREIGN KEY ("id_candidate") REFERENCES "candidates" ("id_candidate");

ALTER TABLE "matches" ADD FOREIGN KEY ("id_candidate") REFERENCES "candidates" ("id_candidate");

ALTER TABLE "matches" ADD FOREIGN KEY ("id_company") REFERENCES "companies" ("id_company");

INSERT INTO users (name, password, email, description) VALUES 
  ('Cloud Strife', 'Strife1!', 'cloudstrife@gmail.com', 'Programador backend júnior'),
  ('Aerith Gainsborough', 'Gainsborough1!', 'aerith@gmail.com', 'Programadora backend plena'),
  ('Vincent Valentine', 'Valentine1!', 'vincent@gmail.com', 'Programador backend pleno'),
  ('Cid Highwind', 'Highwind1!', 'highwind@gmail.com', 'Programador fullstack júnior'),
  ('Sephiroth Crescent', 'Sephiroth1!', 'sephiroth@gmail.com', 'Programador fullstack sênior'),
  ('Shinra', 'Soldier1!', 'shinra@gmail.com', 'Empresa de tecnologia especialista em conversão de energia Mako'),
  ('Tantalus', 'Tantalus1!', 'tantalus@gmail.com', 'Companhia de teatro voltada para tecnologia'),
  ('Balamb Garden', 'Balamb1!', 'balamb@gmail.com', 'Empresa formadora de soldiers'),
  ('Falcie Inc.', 'Falcie1!', 'contato@falcie.com', 'Recrutadora de profissionais para terceiros'),
  ('Zanarkand', 'Zanarkand1!', 'zanarkand@sin.com.sp', 'Transformando sonhos em realidade');

INSERT INTO candidates (id_user, cpf, birthdate) VALUES 
  (1, '13342532113', '1997-01-31'),
  (2, '13342532114', '1997-02-01'),
  (3, '13342532115', '2000-03-01'),
  (4, '13342532116', '2002-04-10'),
  (5, '13342532117', '1997-01-31');

INSERT INTO companies (id_user, cnpj) VALUES 
  (6, '12345678000111'),
  (7, '12345678000112'),
  (8, '12345678000113'),
  (9, '12345678000114'),
  (10, '12345678000115');

INSERT INTO countries (short, long) VALUES 
  ('BRA', 'Brasil'),
  ('EUA', 'Estados Unidos da América');

INSERT INTO addresses (cep, country, state, city, district, street, number, complement) VALUES 
  ('20100100', 1, 'Midgar', 'Midgar', 'Setor 7', 'Seventh Heaven', '7', 'Superior'),
  ('20100102', 2, 'Alexandria', 'Alexandria', 'Centro', 'Rua do Mercado', '99', 'Casa A');

INSERT INTO user_address (id_user, id_address) VALUES 
  (1, 1),
  (2, 1),
  (3, 1),
  (4, 1),
  (5, 1),
  (6, 2),
  (7, 2),
  (8, 2),
  (9, 2),
  (10, 2);

INSERT INTO jobs (id_company, description, locale) VALUES 
  (1, 'Vaga para começo imediato com a melhor remuneração do mercado', 'Midgar'),
  (2, 'Vaga para desenvolvedor frontend júnior, uma raridade!', 'Remoto'),
  (3, 'Vaga de backend com remuneração acima do mercado, dois pães de queijo', 'Alexandria'),
  (4, 'Apenas sênior, favor não incomodar', 'Junon'),
  (5, 'A vaga que você sempre sonhou, nem vai parecer real', 'Remoto');

INSERT INTO competencies (language) VALUES 
  ('TypeScript'), ('Java'), ('HTML'), ('CSS'), ('Javascript'), ('Groovy'), ('Postgresql'), ('Python'), ('Angular');

INSERT INTO candidate_competency (id_candidate, id_competency) VALUES 
  (1, 2),
  (1, 3),
  (1, 6),
  (2, 1),
  (2, 7),
  (3, 8),
  (3, 1),
  (3, 9),
  (4, 3),
  (4, 4),
  (4, 5),
  (5, 6),
  (5, 2);

INSERT INTO job_competency (id_job, id_competency) VALUES 
  (1, 1),
  (1, 9),
  (2, 3),
  (2, 4),
  (2, 5),
  (3, 8),
  (4, 2),
  (5, 7),
  (5, 8);

INSERT INTO likes (date_event) VALUES 
  (NOW()), (NOW()), (NOW()), (NOW()), (NOW());

INSERT INTO like_candidate_job (id_like, id_candidate, id_job) VALUES 
  (1, 1, 4),
  (2, 4, 2),
  (3, 3, 3);

INSERT INTO like_company_candidate (id_like, id_company, id_candidate) VALUES 
  (4, 4, 1),
  (5, 5, 3);

INSERT INTO matches (date_event, id_candidate, id_company) 
  (SELECT NOW(), a.id_candidate, b.id_company FROM like_candidate_job a, like_company_candidate b, jobs c 
  WHERE a.id_job = c.id_job and c.id_company = b.id_company and b.id_candidate = a.id_candidate);



